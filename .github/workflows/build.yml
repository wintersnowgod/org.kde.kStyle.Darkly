name: Build Flatpak Test

on:
  push:
    branches: ['main']  # Trigger on all branch pushes (including website commits)
  pull_request:  # Trigger on pull requests

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install Flatpak and dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y flatpak flatpak-builder
        flatpak remote-add --user --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

    - name: Build Flatpak
      run: |
       flatpak-builder --install-deps-from=flathub --repo=local --force-clean .build-dir org.kde.KStyle.Darkly5.15-24.08.json
       flatpak build-bundle local/ org.kde.kStyle.Darkly.5.15-24.08.flatpak runtime/org.kde.KStyle.Darkly/x86_64/5.15-24.08
       flatpak-builder --install-deps-from=flathub --repo=local --force-clean .build-dir org.kde.KStyle.Darkly6.8.json
       flatpak build-bundle local/ org.kde.kStyle.Darkly6.8.flatpak runtime/org.kde.KStyle.Darkly/x86_64/6.8
       flatpak-builder --install-deps-from=flathub --repo=local --force-clean .build-dir org.kde.KStyle.Darkly6.9.json
       flatpak build-bundle local/ org.kde.kStyle.Darkly6.9.flatpak runtime/org.kde.KStyle.Darkly/x86_64/6.9
